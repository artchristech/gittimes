<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Git Times â€” {{EDITION_DATE}}</title>
  <link rel="alternate" type="application/rss+xml" title="The Git Times RSS" href="{{RSS_URL}}">
  <link rel="alternate" type="application/atom+xml" title="The Git Times Atom" href="{{ATOM_URL}}">
  <style>
{{STYLES}}
  </style>
</head>
<body>

  <div class="toolbar">
    <button class="toolbar-trigger" id="toolbar-toggle" aria-label="Display settings">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"><circle cx="8" cy="8" r="2.5"/><path d="M8 1.5v2M8 12.5v2M1.5 8h2M12.5 8h2M3.17 3.17l1.42 1.42M11.41 11.41l1.42 1.42M3.17 12.83l1.42-1.42M11.41 4.59l1.42-1.42"/></svg>
    </button>
    <div class="toolbar-panel" id="toolbar-panel">
      <div class="panel-group">
        <span class="panel-label">Preset</span>
        <div class="panel-options" data-setting="theme">
          <button class="panel-pill" data-value="light">Light</button>
          <button class="panel-pill" data-value="dark">Dark</button>
          <button class="panel-pill" data-value="sepia">Sepia</button>
          <button class="panel-pill" data-value="midnight">Night</button>
        </div>
      </div>
      <div class="panel-group">
        <div class="panel-label-row">
          <span class="panel-label">Background</span>
          <span class="panel-swatch" id="bg-swatch"></span>
        </div>
        <input type="range" class="panel-slider slider-bg" id="slider-bg" min="0" max="360" step="1">
        <div class="slider-sub">
          <input type="range" class="panel-slider-mini" id="slider-bg-sat" min="0" max="100" step="1">
          <input type="range" class="panel-slider-mini" id="slider-bg-lit" min="0" max="100" step="1">
        </div>
      </div>
      <div class="panel-group">
        <div class="panel-label-row">
          <span class="panel-label">Text</span>
          <span class="panel-swatch" id="text-swatch"></span>
        </div>
        <input type="range" class="panel-slider slider-text" id="slider-text" min="0" max="360" step="1">
        <div class="slider-sub">
          <input type="range" class="panel-slider-mini" id="slider-text-sat" min="0" max="100" step="1">
          <input type="range" class="panel-slider-mini" id="slider-text-lit" min="0" max="100" step="1">
        </div>
      </div>
      <div class="panel-group">
        <span class="panel-label">Font</span>
        <div class="panel-options panel-options-wrap" data-setting="font">
          <button class="panel-pill" data-value="serif">Serif</button>
          <button class="panel-pill" data-value="sans">Sans</button>
          <button class="panel-pill" data-value="mono">Mono</button>
          <button class="panel-pill" data-value="slab">Slab</button>
          <button class="panel-pill" data-value="humanist">Human</button>
          <button class="panel-pill" data-value="editorial">Edit</button>
        </div>
      </div>
      <div class="panel-group">
        <span class="panel-label">Size</span>
        <div class="panel-options" data-setting="size">
          <button class="panel-pill" data-value="small">S</button>
          <button class="panel-pill" data-value="medium">M</button>
          <button class="panel-pill" data-value="large">L</button>
        </div>
      </div>
      <div class="panel-group">
        <span class="panel-label">Width</span>
        <div class="panel-options" data-setting="width">
          <button class="panel-pill" data-value="normal">Normal</button>
          <button class="panel-pill" data-value="wide">Wide</button>
          <button class="panel-pill" data-value="narrow">Narrow</button>
        </div>
      </div>
      <button class="panel-reset" id="panel-reset">Reset</button>
    </div>
  </div>

  <header class="masthead">
    <span class="masthead-date">{{EDITION_DATE}}</span>
    <h1 class="masthead-title">The Git Times</h1>
    <p class="masthead-subtitle">No Narrative.. Just builders building</p>
    <p class="masthead-tagline">{{EDITION_TAGLINE}}</p>
  </header>

  {{SECTION_NAV}}

  {{NAVIGATION}}

  {{SECTION_PANELS}}

  {{LEAD_STORY_SECTION}}

  {{SECONDARY_SECTION}}

  {{QUICK_HITS_SECTION}}

  <footer class="footer">
    {{NAVIGATION}}
    <p>The Git Times is generated by AI from GitHub trending data. All project links verified at time of generation.</p>
    <p>Built with Node.js, GitHub Search API, and xAI Grok</p>
  </footer>

  <script>
    (function () {
      var root = document.documentElement;
      var panel = document.getElementById('toolbar-panel');
      var trigger = document.getElementById('toolbar-toggle');

      var defaults = {
        theme: 'light', font: 'serif', size: 'medium', width: 'normal',
        bgH: '40', bgS: '18', bgL: '97',
        txH: '0', txS: '0', txL: '10'
      };
      var customColors = false;

      // Theme preset color maps (H, S, L for bg and text)
      var presets = {
        light:    { bgH: 40,  bgS: 18, bgL: 97, txH: 0,   txS: 0,  txL: 10 },
        dark:     { bgH: 240, bgS: 8,  bgL: 11, txH: 30,  txS: 6,  txL: 87 },
        sepia:    { bgH: 40,  bgS: 42, bgL: 90, txH: 28,  txS: 28, txL: 20 },
        midnight: { bgH: 215, bgS: 30, bgL: 7,  txH: 210, txS: 10, txL: 82 }
      };

      var state = {};
      Object.keys(defaults).forEach(function (key) {
        state[key] = localStorage.getItem('gittimes-' + key) || defaults[key];
      });

      var sliderBg    = document.getElementById('slider-bg');
      var sliderBgSat = document.getElementById('slider-bg-sat');
      var sliderBgLit = document.getElementById('slider-bg-lit');
      var sliderTx    = document.getElementById('slider-text');
      var sliderTxSat = document.getElementById('slider-text-sat');
      var sliderTxLit = document.getElementById('slider-text-lit');
      var bgSwatch    = document.getElementById('bg-swatch');
      var txSwatch    = document.getElementById('text-swatch');

      function hsl(h, s, l) { return 'hsl(' + h + ',' + s + '%,' + l + '%)'; }

      function deriveColors(h, s, l) {
        // Derive --ink-light, --ink-faint, --rule, --rule-light, --accent from bg/text
        var bgLight = parseInt(l);
        var isDark = bgLight < 50;
        return isDark ? {
          inkLight: hsl(h, Math.max(s - 10, 0), Math.min(parseInt(l) + 30, 80)),
          inkFaint: hsl(h, Math.max(s - 15, 0), Math.min(parseInt(l) + 18, 60)),
          rule:     hsl(h, Math.max(s - 10, 0), Math.min(parseInt(l) + 60, 90)),
          ruleLight:hsl(h, Math.max(s - 12, 0), Math.min(parseInt(l) + 12, 35))
        } : {
          inkLight: hsl(h, Math.max(s - 5, 0), Math.max(parseInt(l) - 55, 20)),
          inkFaint: hsl(h, Math.max(s - 8, 0), Math.max(parseInt(l) - 40, 40)),
          rule:     hsl(h, Math.max(s - 5, 0), Math.max(parseInt(l) - 70, 10)),
          ruleLight:hsl(h, Math.max(s - 10, 0), Math.max(parseInt(l) - 12, 70))
        };
      }

      function applyColors() {
        var bgH = state.bgH, bgS = state.bgS, bgL = state.bgL;
        var txH = state.txH, txS = state.txS, txL = state.txL;
        var bgColor = hsl(bgH, bgS, bgL);
        var txColor = hsl(txH, txS, txL);
        var d = deriveColors(bgH, bgS, bgL);

        root.style.setProperty('--paper', bgColor);
        root.style.setProperty('--ink', txColor);
        root.style.setProperty('--ink-light', d.inkLight);
        root.style.setProperty('--ink-faint', d.inkFaint);
        root.style.setProperty('--rule', d.rule);
        root.style.setProperty('--rule-light', d.ruleLight);

        // Accent based on hue complement
        var accentH = (parseInt(bgH) + 180) % 360;
        root.style.setProperty('--accent', hsl(accentH, 65, parseInt(bgL) < 50 ? 60 : 35));

        // Builder's take bg
        var btL1 = parseInt(bgL) < 50 ? parseInt(bgL) + 5 : parseInt(bgL) - 4;
        var btL2 = parseInt(bgL) < 50 ? parseInt(bgL) + 3 : parseInt(bgL) - 6;
        root.style.setProperty('--bt-bg', 'linear-gradient(135deg,' + hsl(bgH, bgS, btL1) + ',' + hsl(bgH, bgS, btL2) + ')');

        // Update swatches
        bgSwatch.style.background = bgColor;
        txSwatch.style.background = txColor;

        // Sync slider positions
        sliderBg.value = bgH; sliderBgSat.value = bgS; sliderBgLit.value = bgL;
        sliderTx.value = txH; sliderTxSat.value = txS; sliderTxLit.value = txL;

        // Slider track gradients
        sliderBg.style.setProperty('--track', 'linear-gradient(to right,hsl(0,' + bgS + '%,' + bgL + '%),hsl(60,' + bgS + '%,' + bgL + '%),hsl(120,' + bgS + '%,' + bgL + '%),hsl(180,' + bgS + '%,' + bgL + '%),hsl(240,' + bgS + '%,' + bgL + '%),hsl(300,' + bgS + '%,' + bgL + '%),hsl(360,' + bgS + '%,' + bgL + '%))');
        sliderTx.style.setProperty('--track', 'linear-gradient(to right,hsl(0,' + txS + '%,' + txL + '%),hsl(60,' + txS + '%,' + txL + '%),hsl(120,' + txS + '%,' + txL + '%),hsl(180,' + txS + '%,' + txL + '%),hsl(240,' + txS + '%,' + txL + '%),hsl(300,' + txS + '%,' + txL + '%),hsl(360,' + txS + '%,' + txL + '%))');
        sliderBgSat.style.setProperty('--track', 'linear-gradient(to right,' + hsl(bgH, 0, bgL) + ',' + hsl(bgH, 100, bgL) + ')');
        sliderBgLit.style.setProperty('--track', 'linear-gradient(to right,' + hsl(bgH, bgS, 0) + ',' + hsl(bgH, bgS, 50) + ',' + hsl(bgH, bgS, 100) + ')');
        sliderTxSat.style.setProperty('--track', 'linear-gradient(to right,' + hsl(txH, 0, txL) + ',' + hsl(txH, 100, txL) + ')');
        sliderTxLit.style.setProperty('--track', 'linear-gradient(to right,' + hsl(txH, txS, 0) + ',' + hsl(txH, txS, 50) + ',' + hsl(txH, txS, 100) + ')');
      }

      function apply() {
        Object.keys(state).forEach(function (key) {
          root.setAttribute('data-' + key, state[key]);
          localStorage.setItem('gittimes-' + key, state[key]);
        });
        document.querySelectorAll('.panel-options').forEach(function (group) {
          var setting = group.getAttribute('data-setting');
          group.querySelectorAll('.panel-pill').forEach(function (btn) {
            btn.classList.toggle('active', btn.getAttribute('data-value') === state[setting]);
          });
        });
        applyColors();
      }

      apply();

      // Toggle panel
      trigger.addEventListener('click', function (e) {
        e.stopPropagation();
        var open = panel.classList.toggle('open');
        trigger.classList.toggle('active', open);
      });

      // Pill clicks
      panel.addEventListener('click', function (e) {
        var pill = e.target.closest('.panel-pill');
        if (!pill) return;
        e.stopPropagation();
        var group = pill.closest('.panel-options');
        var setting = group.getAttribute('data-setting');
        state[setting] = pill.getAttribute('data-value');
        // If theme preset clicked, sync color sliders
        if (setting === 'theme' && presets[state[setting]]) {
          var p = presets[state[setting]];
          state.bgH = p.bgH; state.bgS = p.bgS; state.bgL = p.bgL;
          state.txH = p.txH; state.txS = p.txS; state.txL = p.txL;
        }
        apply();
      });

      // Slider input handlers
      function onSlider(slider, key) {
        slider.addEventListener('input', function () {
          state[key] = slider.value;
          localStorage.setItem('gittimes-' + key, slider.value);
          applyColors();
        });
      }
      onSlider(sliderBg, 'bgH');
      onSlider(sliderBgSat, 'bgS');
      onSlider(sliderBgLit, 'bgL');
      onSlider(sliderTx, 'txH');
      onSlider(sliderTxSat, 'txS');
      onSlider(sliderTxLit, 'txL');

      // Reset button
      document.getElementById('panel-reset').addEventListener('click', function (e) {
        e.stopPropagation();
        Object.keys(defaults).forEach(function (key) {
          state[key] = defaults[key];
          localStorage.removeItem('gittimes-' + key);
        });
        root.removeAttribute('style');
        apply();
      });

      // Close on outside click
      document.addEventListener('click', function (e) {
        if (!e.target.closest('.toolbar')) {
          panel.classList.remove('open');
          trigger.classList.remove('active');
        }
      });

      // Close on Escape
      document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') {
          panel.classList.remove('open');
          trigger.classList.remove('active');
        }
      });

      // Section tab switching
      var tabs = document.querySelectorAll('.section-tab');
      var panels = document.querySelectorAll('.section-panel');
      tabs.forEach(function(tab) {
        tab.addEventListener('click', function() {
          if (tab.disabled) return;
          tabs.forEach(function(t) { t.classList.remove('active'); });
          panels.forEach(function(p) { p.classList.remove('active'); });
          tab.classList.add('active');
          var id = tab.getAttribute('data-section');
          var panel = document.querySelector('.section-panel[data-section="' + id + '"]');
          if (panel) panel.classList.add('active');
          localStorage.setItem('gittimes-section', id);
        });
      });
      // Restore saved section
      var savedSection = localStorage.getItem('gittimes-section');
      if (savedSection) {
        var savedTab = document.querySelector('.section-tab[data-section="' + savedSection + '"]');
        if (savedTab && !savedTab.disabled) savedTab.click();
      }

      // Quick hits expand/collapse (per-section toggles)
      document.querySelectorAll('.quick-hits-toggle').forEach(function(toggle) {
        var list = toggle.previousElementSibling;
        toggle.addEventListener('click', function() {
          var expanded = list.classList.toggle('expanded');
          toggle.textContent = expanded ? 'Show less' : 'Show more';
        });
      });

      // Legacy single quick-hits toggle fallback
      var qhToggle = document.getElementById('qh-toggle');
      if (qhToggle) {
        var qhList = qhToggle.previousElementSibling;
        qhToggle.addEventListener('click', function() {
          var expanded = qhList.classList.toggle('expanded');
          qhToggle.textContent = expanded ? 'Show less' : 'Show more';
        });
      }
    })();
  </script>

</body>
</html>
